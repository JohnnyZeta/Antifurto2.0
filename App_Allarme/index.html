<!doctype html><html lang=it class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link href=https://JohnnyZeta.github.io/Antifurto2.0/App_Allarme/ rel=canonical><meta name=author content=albyzambo><meta name=lang:clipboard.copy content=Copia><meta name=lang:clipboard.copied content=Copiato><meta name=lang:search.language content=it><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="Nessun documento trovato"><meta name=lang:search.result.one content="1 documento trovato"><meta name=lang:search.result.other content="# documenti trovati"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>App Allarme - Antifurto 2.0</title><link rel=stylesheet href=../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=black data-md-color-accent=teal> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#la-configurazione-in-appsyaml tabindex=0 class=md-skip> Vai al contenuto </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://JohnnyZeta.github.io/Antifurto2.0/ title="Antifurto 2.0" aria-label="Antifurto 2.0" class="md-header-nav__button md-logo"> <i class=md-icon>vpn_key</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Antifurto 2.0 </span> <span class=md-header-nav__topic> App Allarme </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Cerca autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Scrivi per iniziare a cercare </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/JohnnyZeta/Antifurto2.0/ title="Apri repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://JohnnyZeta.github.io/Antifurto2.0/ title="Antifurto 2.0" class="md-nav__button md-logo"> <i class=md-icon>vpn_key</i> </a> Antifurto 2.0 </label> <div class=md-nav__source> <a href=https://github.com/JohnnyZeta/Antifurto2.0/ title="Apri repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Introduzione class=md-nav__link> Introduzione </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> App Allarme </label> <a href=./ title="App Allarme" class="md-nav__link md-nav__link--active"> App Allarme </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Indice</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#la-configurazione-in-appsyaml class=md-nav__link> La configurazione in apps.yaml </a> </li> <li class=md-nav__item> <a href=#il-file-pyallarmepy class=md-nav__link> Il file pyAllarme.py </a> </li> <li class=md-nav__item> <a href=#callbacks class=md-nav__link> Callbacks </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#la-fase-di-registrazione class=md-nav__link> La fase di registrazione </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#descrizione-del-funzionamento class=md-nav__link> Descrizione del funzionamento </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#funzione-toggle_antifurto class=md-nav__link> Funzione toggle_antifurto </a> </li> <li class=md-nav__item> <a href=#funzione-notifica_mobile class=md-nav__link> Funzione notifica_mobile </a> </li> <li class=md-nav__item> <a href=#funzione-gestisci_eventi class=md-nav__link> Funzione gestisci_eventi </a> </li> <li class=md-nav__item> <a href=#funzione-sta_suonando class=md-nav__link> Funzione sta_suonando </a> </li> <li class=md-nav__item> <a href=#funzione-finestre class=md-nav__link> Funzione finestre </a> </li> <li class=md-nav__item> <a href=#funzioni-dimenticanza-e-dimenticanzanotturna class=md-nav__link> Funzioni dimenticanza e dimenticanzanotturna </a> </li> <li class=md-nav__item> <a href=#funzione-gestisci_rfid class=md-nav__link> Funzione gestisci_rfid </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusioni class=md-nav__link> Conclusioni </a> </li> <li class=md-nav__item> <a href=#breve-sitografia class=md-nav__link> Breve sitografia </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Indice</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#la-configurazione-in-appsyaml class=md-nav__link> La configurazione in apps.yaml </a> </li> <li class=md-nav__item> <a href=#il-file-pyallarmepy class=md-nav__link> Il file pyAllarme.py </a> </li> <li class=md-nav__item> <a href=#callbacks class=md-nav__link> Callbacks </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#la-fase-di-registrazione class=md-nav__link> La fase di registrazione </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#descrizione-del-funzionamento class=md-nav__link> Descrizione del funzionamento </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#funzione-toggle_antifurto class=md-nav__link> Funzione toggle_antifurto </a> </li> <li class=md-nav__item> <a href=#funzione-notifica_mobile class=md-nav__link> Funzione notifica_mobile </a> </li> <li class=md-nav__item> <a href=#funzione-gestisci_eventi class=md-nav__link> Funzione gestisci_eventi </a> </li> <li class=md-nav__item> <a href=#funzione-sta_suonando class=md-nav__link> Funzione sta_suonando </a> </li> <li class=md-nav__item> <a href=#funzione-finestre class=md-nav__link> Funzione finestre </a> </li> <li class=md-nav__item> <a href=#funzioni-dimenticanza-e-dimenticanzanotturna class=md-nav__link> Funzioni dimenticanza e dimenticanzanotturna </a> </li> <li class=md-nav__item> <a href=#funzione-gestisci_rfid class=md-nav__link> Funzione gestisci_rfid </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusioni class=md-nav__link> Conclusioni </a> </li> <li class=md-nav__item> <a href=#breve-sitografia class=md-nav__link> Breve sitografia </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/JohnnyZeta/Antifurto2.0/edit/master/docs/App_Allarme.md title=Modifica class="md-icon md-content__icon">&#xE3C9;</a> <h1>App Allarme</h1> <h2 id=la-configurazione-in-appsyaml>La configurazione in <code>apps.yaml</code><a class=headerlink href=#la-configurazione-in-appsyaml title="Permanent link"> #</a></h2> <p>Grazie alle <a href=https://appdaemon.readthedocs.io/en/latest/APPGUIDE.html#passing-arguments-to-apps>caratteristiche di AppDaemon</a> ho potuto separare il codice vero e proprio dalla sua configurazione, rendendo l'App in questione sostanzialmente "indipendente" dal sistema dove verrà eseguita. Gli argomenti passati al codice saranno quindi (da inserire nel mio caso nel file <code>apps.yaml</code>): <sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup></p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=n>Allarme</span><span class=p>:</span>
  <span class=n>module</span><span class=p>:</span> <span class=n>Allarme</span>
  <span class=n>class</span><span class=p>:</span> <span class=n>pyAllarme</span>
  <span class=n>log</span><span class=p>:</span> <span class=n>log_allarme</span>
  <span class=n>indirizzo_ip</span><span class=p>:</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>1.2</span>
  <span class=n>token</span><span class=p>:</span> <span class=err>!</span><span class=n>secret</span> <span class=n>token_appdaemon</span>
  <span class=n>notifiche_ios</span><span class=p>:</span> <span class=kc>True</span>
  <span class=n>sensore_sirena</span><span class=p>:</span> <span class=n>binary_sensor</span><span class=o>.</span><span class=n>allarme_antifurto</span>
  <span class=n>switch_antifurto</span><span class=p>:</span> <span class=n>switch</span><span class=o>.</span><span class=n>antifurto_template</span>
  <span class=n>rfid</span><span class=p>:</span>
    <span class=n>lettore_rfid</span><span class=p>:</span> <span class=n>input_text</span><span class=o>.</span><span class=n>rfid</span>
    <span class=n>tag_abilitati</span><span class=p>:</span>
      <span class=s2>&quot;Alberto&quot;</span><span class=p>:</span> <span class=mi>11</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>11</span>
      <span class=s2>&quot;Alessandra&quot;</span><span class=p>:</span> <span class=mi>22</span><span class=o>-</span><span class=mi>22</span><span class=o>-</span><span class=mi>22</span><span class=o>-</span><span class=mi>22</span>
  <span class=n>gruppo_abitanti_casa</span><span class=p>:</span> <span class=n>group</span><span class=o>.</span><span class=n>famiglia</span>
  <span class=n>servizio_notify_push</span><span class=p>:</span>
    <span class=o>-</span> <span class=n>mobile_app_iphone_di_alberto</span>
    <span class=o>-</span> <span class=n>mobile_app_iphone_di_alessandra</span>
  <span class=n>accendi_luci</span><span class=p>:</span>
    <span class=n>elenco_luci</span><span class=p>:</span>
      <span class=o>-</span> <span class=n>light</span><span class=o>.</span><span class=n>bagno</span>
      <span class=o>...</span>
  <span class=n>avviso_finestre</span><span class=p>:</span>
    <span class=n>elenco_finestre</span><span class=p>:</span>
      <span class=o>-</span> <span class=n>binary_sensor</span><span class=o>.</span><span class=n>finestra_bagno</span>
      <span class=o>...</span>
  <span class=n>allarme_dimenticato</span><span class=p>:</span>
    <span class=n>minuti_attesa</span><span class=p>:</span> <span class=mi>15</span>
    <span class=n>avviso_notturno</span><span class=p>:</span>
      <span class=n>ora_inizio</span><span class=p>:</span> <span class=s2>&quot;22:30:00&quot;</span>
</code></pre></div> </td></tr></table> <h2 id=il-file-pyallarmepy>Il file pyAllarme.py<a class=headerlink href=#il-file-pyallarmepy title="Permanent link"> #</a></h2> <p>Iniziamo dal file <code>Allarme.py</code>, che contiene il codice vero e proprio interpretato da AppDaemon: vediamolo e commentiamolo un pezzo alla volta, così da chiarirne bene il funzionamento.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=kn>import</span> <span class=nn>hassapi</span> <span class=k>as</span> <span class=nn>hass</span>
<span class=kn>import</span> <span class=nn>requests</span> <span class=k>as</span> <span class=nn>req</span>

<span class=k>class</span> <span class=nc>pyAllarme</span><span class=p>(</span><span class=n>hass</span><span class=o>.</span><span class=n>Hass</span><span class=p>):</span>

    <span class=k>def</span> <span class=nf>initialize</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Inizializzazione pyAllarme!&quot;</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Inizializzazione pyAllarme!&quot;</span><span class=p>,</span> <span class=n>log</span><span class=o>=</span><span class=s2>&quot;main_log&quot;</span><span class=p>)</span>
</code></pre></div> </td></tr></table> <p>Partendo dalle prime righe notiamo l'aggiunta delle librerie <code>hassapi</code> e <code>requests</code>: la prima è indispensabile per il funzionamento di AppDaemon, mentre la seconda la utilizzeremo per la generazione delle notifiche di tipo <em>actionable</em> e <em>critical</em> che approfondiremo in seguito. Subito dopo troviamo la fase in cui dichiariamo la classe che sfrutteremo per la nostra App <code>Allarme</code> e definiamo la funzione di inizializzazione, indispensabile in ogni classe di AppDaemon. Nelle prime righe del file di configurazione dell'App <code>Allarme</code> ritroviamo i riferimenti che abbiamo appena citato: - <code>Allarme:</code> indica il nome dell'App che siamo configurando; - <code>module: Allarme</code> fa riferimento al file <code>Allarme.py</code> che contiene il codice della classe che utilizzeremo; - <code>class: pyAllarme</code> specifica che utilizzeremo proprio al classe in questione, scritta nel file (e quindi nel modulo) appena citato.</p> <p>Proseguiamo scrivendo nei log che è in corso l'inizializzazione della classe pyAllarme: sfruttiamo così un file di log specifico per questa App (<code>log_allarme.log</code> appunto, inserito nella configurazione generale dell'App alla riga <code>log: log_allarme</code>, che va creato prima dell'uso) dove si possano controllare tutti gli eventi collegati all'Antifurto 2.0. In questo caso il messaggio "Inizializzazione pyAllarme!" verrà scritto anche nel log dell'addon di AppDaemon su Home Assistant, che viene indicato di default come <code>main_log</code>.</p> <h2 id=callbacks>Callbacks<a class=headerlink href=#callbacks title="Permanent link"> #</a></h2> <h3 id=la-fase-di-registrazione>La fase di registrazione<a class=headerlink href=#la-fase-di-registrazione title="Permanent link"> #</a></h3> <p>Subito dopo la scrittura dei log inizia la fase di inizializzazione vera e propria, composta dalla registrazione delle funzioni di callback.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=c1>##### 1</span>
<span class=bp>self</span><span class=o>.</span><span class=n>listen_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>toggle_antifurto</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span>

<span class=c1>##### 2</span>
<span class=bp>self</span><span class=o>.</span><span class=n>listen_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sta_suonando</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;sensore_sirena&quot;</span><span class=p>],</span> <span class=n>new</span><span class=o>=</span><span class=s2>&quot;on&quot;</span><span class=p>)</span>

<span class=c1>###### 3</span>
<span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;notifiche_ios&quot;</span><span class=p>]:</span>
    <span class=n>evento_notifica</span> <span class=o>=</span> <span class=s2>&quot;ios.notification_action_fired&quot;</span>
<span class=k>else</span><span class=p>:</span>
    <span class=n>evento_notifica</span> <span class=o>=</span> <span class=s2>&quot;mobile_app_notification_action&quot;</span>
<span class=bp>self</span><span class=o>.</span><span class=n>listen_event</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>gestisci_eventi</span><span class=p>,</span> <span class=n>event</span><span class=o>=</span><span class=n>evento_notifica</span><span class=p>)</span>
</code></pre></div> </td></tr></table> <p>La funzione <a href=https://appdaemon.readthedocs.io/en/stable/AD_API_REFERENCE.html#appdaemon.adapi.ADAPI.listen_state><code>listen_state()</code></a> è una delle più comunemente sfruttate in AppDaemon: permette infatti di registrare una funzione di <a href=https://it.wikipedia.org/wiki/Callback><strong>callback</strong></a> (o di <em>richiamo</em>, in italiano) legandola al cambio di stato di un entità specificata.</p> <p>La funzione di callback non è nient'altro che una funzione, appunto, che viene chiamata nel caso che l'entità osservata da <code>listen_state</code> cambi stato. Prendiamo come esempio la parte di codice indicata con il numero 1: il callback è <code>toggle_antifurto</code>, legato ai cambiamenti di stato dell'entità inserita in configurazione sotto <code>switch_antifurto</code> (nel mio caso <code>switch.antifurto_template</code>, come abbiamo visto prima) e richiamata tramite <code>self.args[]</code> (che non fa nient'altro che andare a <em>pescare</em> nel file di configurazione dell'App il nome dell'entità che noi avremo specificato).</p> <div class="admonition info"> <p>Come avremo modo di descrivere meglio <a href=./#funzione-toggle_antifurto>in seguito</a>, nel momento in cui il callback viene <em>richiamato</em> gli vengono anche forniti una serie di informazioni su ciò che ha causato il suo richiamo: le potremo utilizzare per costruire la nostra logica con cui far lavorare AppDaemon.</p> </div> <p>Alla stessa maniera registriamo un callback <code>sta_suonando</code> relativamente all'entità specificata in configurazione sotto <code>sensore_sirena</code> (nel mio caso <code>binary_sensor.allarme_antifurto</code>). In questo caso specifichiamo che il callback verrà chiamato <em>solo se</em> lo stato in cui il sensore sirena cambia sarà <strong>on</strong>: questa ulteriore specifica ci permette di procedere solo quando la sirena inizi a suonare, e non nel caso in cui abbia appena smesso (nuovo stato <strong>off</strong>).</p> <p>La terza registrazione di questo blocco di codice permette di specificare un callback che utilizzeremo per gestire le notifiche Push provenienti dalle App di Home Assistant sui nostri cellulari. <code>notifiche_ios</code> è un parametro booleano presente in configurazione, che serve a specificare se intendiamo utilizzare per le notifiche telefoni iOS (<code>True</code>) o Android (<code>False</code>).</p> <p>Incontriamo anche la funzione di AppDaemon <code>listen_event</code>: permette di registrare un callback che verrà chiamato quando Home Assistant genererà un evento specifico. Nel nostro caso si tratta di un evento di tipo <code>ios.notification_action_fired</code> o <code>mobile_app_notification_action</code> nel caso in cui lo generi un'App ufficiale di HA installata rispettivamente su un dispositivo iOS o Android.</p> <p><table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=c1>##### 4</span>
<span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;rfid&quot;</span><span class=p>]:</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>listen_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>gestisci_rfid</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;rfid&quot;</span><span class=p>][</span><span class=s2>&quot;lettore_rfid&quot;</span><span class=p>])</span>

<span class=c1>##### 5</span>
<span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;avviso_finestre&quot;</span><span class=p>]:</span>
    <span class=k>for</span> <span class=n>finestra</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;avviso_finestre&quot;</span><span class=p>][</span><span class=s2>&quot;elenco_finestre&quot;</span><span class=p>]:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>listen_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>finestre</span><span class=p>,</span> <span class=n>finestra</span><span class=p>,</span> <span class=n>new</span><span class=o>=</span><span class=s2>&quot;on&quot;</span><span class=p>)</span>

<span class=c1>##### 6</span>
<span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;allarme_dimenticato&quot;</span><span class=p>]:</span>
    <span class=n>durata_secondi</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;allarme_dimenticato&quot;</span><span class=p>][</span><span class=s2>&quot;minuti_attesa&quot;</span><span class=p>]</span> <span class=o>*</span> <span class=mi>60</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>listen_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dimenticanza</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;gruppo_abitanti_casa&quot;</span><span class=p>],</span> <span class=n>new</span><span class=o>=</span><span class=s2>&quot;not_home&quot;</span><span class=p>,</span> <span class=n>duration</span><span class=o>=</span><span class=n>durata_secondi</span><span class=p>)</span>

    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;allarme_dimenticato&quot;</span><span class=p>][</span><span class=s2>&quot;avviso_notturno&quot;</span><span class=p>]:</span>
        <span class=n>orario</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;allarme_dimenticato&quot;</span><span class=p>][</span><span class=s2>&quot;avviso_notturno&quot;</span><span class=p>][</span><span class=s2>&quot;ora_inizio&quot;</span><span class=p>]</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>run_at</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dimenticanzanotturna</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=n>orario</span><span class=p>)</span>
</code></pre></div> </td></tr></table> Il secondo ed ultimo blocco della fase di <code>initialize</code> del codice contiene le ultime tre registrazioni che ci interessano.</p> <p>La numero 4 verrà utilizzata per inserire e disinserire l'antifurto mediante chip RFID o NFC, passando dal callback <code>gestisci_rfid</code>.<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup></p> <p>La registrazione successiva ci permette di mostrare la possibilità di leggere un elenco di entità presenti nel file di configurazione, mediante un <a href=https://appdaemon.readthedocs.io/en/3.0.5/APPGUIDE.html#passing-arguments-to-apps>ciclo for</a>: essendo <code>elenco_finestre</code> annidato dentro le preferenze di <code>allarme_dimenticato</code>, dobbiamo fornire a <code>self.args[]</code> il percorso corretto: <code>self.args["avviso_finestre"]["elenco_finestre"]</code>. Per ogni <code>finestra</code> viene registrato un callback (<code>finestre</code>) che verrà chiamato ogni volta che il nuovo stato dell'entità sarà pari a <strong>on</strong>.</p> <p>L'ultima registrazione viene usata per implementare gli avvisi che dovrebbero scattare nel caso in cui si dimentichi di inserire l'antifurto uscendo di casa, o la sera prima di andare a dormire. Nel primo caso è necessario inserire in configurazione il numero di minuti da attendere a <em>casa vuota</em> prima di chiamare il callback conseguente, mentre nel secondo l'orario al quale far generare la notifica.</p> <div class="admonition info"> <p class=admonition-title>Casa vuota</p> <p>Per l'informazione della <em>casa vuota</em> utilizziamo il <a href=https://www.home-assistant.io/integrations/group/#group-behavior>gruppo</a> <code>gruppo abitanti casa</code> che contiene all'interno tutte le entità <code>person</code> o <code>device_tracker</code> di Home Assistant riferite alle persone che vivono con noi: questo tipo di gruppo assume lo stato di <code>home</code> se <em>almeno una</em> di queste risulta a casa, e <code>not_home</code> se <em>nessuna</em> di queste risulta a casa.</p> </div> <p>Le <a href=https://appdaemon.readthedocs.io/en/stable/AD_API_REFERENCE.html#appdaemon.adapi.ADAPI.listen_state>specifiche</a> della funzione <code>listen_state</code> permettono l'uso di un parametro <code>duration</code>, che indica la durata (in secondi) per cui deve essere mantenuto il nuovo stato che assume l'entità monitorata: nel nostro caso la funzione di callback <code>dimenticanza</code> verrà chiamata solo dopo un periodo di attesa pari a <code>durata_secondi</code>, ottenuta moltiplicando <code>minuti_attesa</code> per 60. La funzione di avviso notturno funziona invece impostando in configurazione un orario nel formato <code>HH:MM:SS</code> e sfruttando la <a href=https://appdaemon.readthedocs.io/en/stable/AD_API_REFERENCE.html#appdaemon.adapi.ADAPI.run_at>funzione di pianificazione</a> AppDaemon <code>run_at</code>, che chiamerà il callback <code>dimenticanzanotturna</code> ogni giorno all'orario specificato.</p> <h2 id=descrizione-del-funzionamento>Descrizione del funzionamento<a class=headerlink href=#descrizione-del-funzionamento title="Permanent link"> #</a></h2> <p>I callbacks sono la parte di codice <em>operativa</em> che indica ad Home Assistant una serie di operazioni di effettuare, quali servizi chiamare e cosa notificare, per esempio. La nostra attuale versione di pyAllarme ne sfrutta otto: iniziamo a vederli in dettaglio.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=c1>#####</span>
<span class=k>def</span> <span class=nf>toggle_antifurto</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entity</span><span class=p>,</span> <span class=n>attribute</span><span class=p>,</span> <span class=n>old</span><span class=p>,</span> <span class=n>new</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>new</span> <span class=o>==</span> <span class=s2>&quot;on&quot;</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Antifurto Inserito&quot;</span><span class=p>)</span>
    <span class=k>elif</span> <span class=n>new</span> <span class=o>==</span> <span class=s2>&quot;off&quot;</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Antifurto Disinserito&quot;</span><span class=p>)</span>

<span class=c1>#####</span>
<span class=k>def</span> <span class=nf>notifica_mobile</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>servizio_notify</span><span class=p>,</span> <span class=n>tipo</span><span class=p>,</span> <span class=n>titolo</span><span class=p>,</span> <span class=n>messaggio</span><span class=p>):</span>
    <span class=n>url</span> <span class=o>=</span> <span class=s2>&quot;http://&quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;indirizzo_ip&quot;</span><span class=p>])</span> <span class=o>+</span> <span class=s2>&quot;:8123/api/services/notify/&quot;</span> <span class=o>+</span> <span class=n>servizio_notify</span>
    <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&quot;Authorization&quot;</span><span class=p>:</span> <span class=s2>&quot;Bearer &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;token&quot;</span><span class=p>]),</span> <span class=s2>&quot;content-type&quot;</span><span class=p>:</span> <span class=s2>&quot;application/json&quot;</span><span class=p>,</span> <span class=p>}</span>
    <span class=k>if</span> <span class=n>tipo</span> <span class=o>==</span> <span class=s2>&quot;actionable&quot;</span><span class=p>:</span>
        <span class=n>data_json</span> <span class=o>=</span> <span class=s1>&#39;{&quot;message&quot;:&quot;&#39;</span> <span class=o>+</span> <span class=n>messaggio</span> <span class=o>+</span> <span class=s1>&#39;&quot;,&quot;title&quot;:&quot;&#39;</span> <span class=o>+</span> <span class=n>titolo</span> <span class=o>+</span> <span class=s1>&#39;&quot;,&quot;data&quot;:{&quot;push&quot;:{&quot;category&quot;:&quot;allarme&quot;}}}&#39;</span>
    <span class=k>elif</span> <span class=n>tipo</span> <span class=o>==</span> <span class=s2>&quot;critical&quot;</span><span class=p>:</span>
        <span class=n>data_json</span> <span class=o>=</span> <span class=s1>&#39;{&quot;message&quot;:&quot;&#39;</span> <span class=o>+</span> <span class=n>messaggio</span> <span class=o>+</span> <span class=s1>&#39;&quot;,&quot;title&quot;:&quot;&#39;</span> <span class=o>+</span> <span class=n>titolo</span> <span class=o>+</span> <span class=s1>&#39;&quot;,&quot;data&quot;:{&quot;push&quot;:{&quot;sound&quot;:{&quot;name&quot;:&quot;default&quot;,&quot;critical&quot;:&quot;1&quot;,&quot;volume&quot;:&quot;1.0&quot;}}}}&#39;</span>
    <span class=k>elif</span> <span class=n>tipo</span> <span class=o>==</span><span class=s2>&quot;mix&quot;</span><span class=p>:</span>
        <span class=n>data_json</span> <span class=o>=</span> <span class=s1>&#39;{&quot;message&quot;:&quot;&#39;</span> <span class=o>+</span> <span class=n>messaggio</span> <span class=o>+</span> <span class=s1>&#39;&quot;,&quot;title&quot;:&quot;&#39;</span> <span class=o>+</span> <span class=n>titolo</span> <span class=o>+</span> <span class=s1>&#39;&quot;,&quot;data&quot;:{&quot;push&quot;:{&quot;category&quot;:&quot;allarme&quot;,&quot;sound&quot;:{&quot;name&quot;:&quot;default&quot;,&quot;critical&quot;:&quot;1&quot;,&quot;volume&quot;:&quot;1.0&quot;}}}}&#39;</span>
    <span class=n>req</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data_json</span><span class=p>)</span>

<span class=c1>#####</span>
<span class=k>def</span> <span class=nf>gestisci_eventi</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event_name</span><span class=p>,</span> <span class=n>data</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>

    <span class=c1># iOS</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;notifiche_ios&quot;</span><span class=p>]:</span>
        <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;actionName&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;ALLARME_ON&quot;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Attivo allarme da &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;sourceDeviceName&quot;</span><span class=p>]))</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;off&quot;</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>call_service</span><span class=p>(</span><span class=s2>&quot;switch/turn_on&quot;</span><span class=p>,</span> <span class=n>entity_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span>
        <span class=k>elif</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;actionName&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;ALLARME_OFF&quot;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Disattivo allarme da &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&quot;sourceDeviceName&quot;</span><span class=p>]))</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;on&quot;</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>call_service</span><span class=p>(</span><span class=s2>&quot;switch/turn_off&quot;</span><span class=p>,</span> <span class=n>entity_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span>

    <span class=c1># Android</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>if</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;action&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;ALLARME_ON&quot;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Attivo allarme&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;off&quot;</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>call_service</span><span class=p>(</span><span class=s2>&quot;switch/turn_on&quot;</span><span class=p>,</span> <span class=n>entity_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span>
        <span class=k>elif</span> <span class=n>data</span><span class=p>[</span><span class=s2>&quot;action&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&quot;ALLARME_OFF&quot;</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Disattivo allarme&quot;</span><span class=p>)</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;on&quot;</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>call_service</span><span class=p>(</span><span class=s2>&quot;switch/turn_off&quot;</span><span class=p>,</span> <span class=n>entity_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span>
</code></pre></div> </td></tr></table> <h3 id=funzione-toggle_antifurto>Funzione <code>toggle_antifurto</code><a class=headerlink href=#funzione-toggle_antifurto title="Permanent link"> #</a></h3> <p>Il primo che incontriamo è un callback molto semplice: lo scopo di <code>toggle_antifurto</code> è quello di scrivere nel log della App quando l'antifurto viene inserito o disinserito, ai fini di debug. Come anticipato <a href=./#la-fase-di-registrazione>in precedenza</a>, un callback che viene chiamato da una funzione <code>listen_state</code> (come specificato nella <a href=https://appdaemon.readthedocs.io/en/latest/APPGUIDE.html#state-callbacks>documentazione</a>) ha a disposizione una serie di argomenti (<code>entity, attribute, old, new</code>) da utilizzare nel suo codice. In questo caso abbiamo sfruttato il parametro <code>new</code>, che ci fornisce il nuovo stato che assume l'entità dopo il cambio: essendoci <em>abbonati</em> all'entità specificata in <code>toggle_antifurto</code> il ciclo if ci permette di loggare due messaggi differenti, a seconda che il nuovo stato sia <strong>on</strong> o <strong>off</strong>.</p> <h3 id=funzione-notifica_mobile>Funzione <code>notifica_mobile</code><a class=headerlink href=#funzione-notifica_mobile title="Permanent link"> #</a></h3> <p>La seconda funzione che incontriamo sfrutta le caratteristiche della libreria Python <a href=https://requests.readthedocs.io/projects/it/it/latest/#>Request</a>, che permette di semplificare molto l'uso di chiamate <a href=https://it.wikipedia.org/wiki/Representational_State_Transfer>RESTful</a> (e per questo motivo è tra le librerie più utilizzate in assoluto).</p> <details class=tip><summary>Addon</summary><p>Se abbiamo installato AppDaemon dall'addon della Community di Home Assistant ricordiamoci di inserire <code>Requests</code> nella configurazione dell'addon, sotto <code>python_packages</code> per permetterne l'installazione.</p> </details> <p>Non si tratta di un callback in questo caso, ma di una funzione che scriviamo per facilitarci la successiva gestione del meccanismo di notifica sulle App di Home Assistant su iOS ed Android. <code>notifica_mobile</code>, infatti, accetta <code>servizio_notify</code> e <code>tipo</code> come argomenti: il primo ci serve per specificare su quale dispositivo inviare la notifica (basandoci sul servizio <code>notify</code> che crea Home Assistant per ogni modalità di notifica aggiunta), mentre il secondo è usato per scegliere che tipo di notifica inviare. Per quanto riguarda iOS, Apple permette di utilizzarne due tipi <em>speciali</em>:</p> <table> <thead> <tr> <th>Tipo</th> <th>Caratteristiche</th> </tr> </thead> <tbody> <tr> <td><strong>Actionable</strong></td> <td>permettono di sfruttare fino a quattro <em>pulsanti</em> che appaiono sotto la notifica per compiere una serie di azioni da noi specificate, o di inserire del testo in una maschera;</td> </tr> <tr> <td><strong>Critical</strong></td> <td>introdotte con iOS 12, sono notifiche considerate prioritarie: per questo motivo appaiono sempre in cime alle altre, e riproducono il loro suono anche se il telefono è in modalità sileziosa.</td> </tr> </tbody> </table> <div class="admonition info"> <p>Sfruttare una notifica <em>actionable</em> implica una configurazione ulteriore che più essere fatta sia a livello del file <code>configuration.yaml</code> sia attraverso l'App ufficiale di Home Assistant: in ogni caso vi consiglio una lettura della <a href=https://companion.home-assistant.io/docs/notifications/actionable-notifications>pagina della documentazione di HA</a> per i passaggi esatti con cui procedere.</p> </div> <p>Nel mio caso sono passato dal file di configurazione: <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=nt>ios</span><span class=p>:</span>
  <span class=nt>push</span><span class=p>:</span>
    <span class=nt>categories</span><span class=p>:</span>
      <span class="p p-Indicator">-</span> <span class=nt>name</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">Allarme</span>
        <span class=nt>identifier</span><span class=p>:</span> <span class=s>&#39;allarme&#39;</span>
        <span class=nt>actions</span><span class=p>:</span>
          <span class="p p-Indicator">-</span> <span class=nt>identifier</span><span class=p>:</span> <span class=s>&#39;ALLARME_ON&#39;</span>
            <span class=nt>title</span><span class=p>:</span> <span class=s>&#39;Allarme</span><span class=nv> </span><span class=s>ON&#39;</span>
            <span class=nt>activationMode</span><span class=p>:</span> <span class=s>&#39;background&#39;</span>
            <span class=nt>authenticationRequired</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
            <span class=nt>destructive</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
            <span class=nt>behavior</span><span class=p>:</span> <span class=s>&#39;default&#39;</span>
          <span class="p p-Indicator">-</span> <span class=nt>identifier</span><span class=p>:</span> <span class=s>&#39;ALLARME_OFF&#39;</span>
            <span class=nt>title</span><span class=p>:</span> <span class=s>&#39;Allarme</span><span class=nv> </span><span class=s>OFF&#39;</span>
            <span class=nt>activationMode</span><span class=p>:</span> <span class=s>&#39;background&#39;</span>
            <span class=nt>authenticationRequired</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
            <span class=nt>destructive</span><span class=p>:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
            <span class=nt>behavior</span><span class=p>:</span> <span class=s>&#39;default&#39;</span>
</code></pre></div> </td></tr></table></p> <p>Lo scopo del codice era originariamente quello di poter sfruttare le notifiche <em>actionable</em> per inserire e disinserire l'antifurto, il suonare della sirena (e l'apertura finestre ad antifurto inserito) segnalato invece con notifiche <em>critical</em>.</p> <p>La funzione <code>notifica_mobile</code> va oltre, e permette di utilizzare anche una notifica di tipo <em>mix</em>: una notifica che unisce le caratteristiche di entrambe (<em>actionable</em> + <em>critical</em>). Per sfruttare questa funzione sarà necessario conoscere l'indirizzo ip dell'istanza di Home Assistant, e generare un <em>token</em> (Profilo -&gt; Token di accesso a lunga vita) che dovrà essere scritto nel file di configurazione sotto <code>token</code>, o nel file <code>secret.yaml</code> di Home Assistant e richiamato con <code>!secret token_appdaemon</code> come nel caso indicato sopra.</p> <h3 id=funzione-gestisci_eventi>Funzione <code>gestisci_eventi</code><a class=headerlink href=#funzione-gestisci_eventi title="Permanent link"> #</a></h3> <p>Allo schiacciare dei bottoni che appiono sotto delle notifiche di tipo <em>actionable</em> viene generato un evento specifico nel Bus eventi di Home Assistant, del tipo <a href=./#la-fase-di-registrazione>già citato</a>. Lo scopo della funzione <code>gestisci_eventi</code> è quello di interpretare l'evento in arrivo, ed eseguire istruzioni di conseguenza.</p> <p>La funzione è divisa in due parti: una è relativa ai dispositivi iOS, e l'altra a quelli Android. Il <code>payload</code> proveniente dall'evento cambia infatti a seconda dell'App che l'ha generato, sia in struttura che in contenuto: la decodifica di questi dati avviene tramite un paio di cicli if, e sfrutta <a href=https://appdaemon.readthedocs.io/en/latest/AD_API_REFERENCE.html#appdaemon.adapi.ADAPI.call_service>la funzione di AppDaemon</a> <code>call_service</code>, che permette di chiamare il servizio <code>turn_on</code> o <code>turn_off</code> sullo switch che controlla l'antifurto.</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=c1>#####</span>
<span class=k>def</span> <span class=nf>sta_suonando</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entity</span><span class=p>,</span> <span class=n>attribute</span><span class=p>,</span> <span class=n>old</span><span class=p>,</span> <span class=n>new</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Allarme! La sirena sta suonando!&quot;</span><span class=p>,</span> <span class=n>log</span><span class=o>=</span><span class=s2>&quot;main_log&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;WARNING&quot;</span><span class=p>)</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Allarme! La sirena sta suonando!&quot;</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;WARNING&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>sun_down</span><span class=p>():</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;accendi_luci&quot;</span><span class=p>]:</span>
                <span class=k>for</span> <span class=n>luce</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;accendi_luci&quot;</span><span class=p>][</span><span class=s2>&quot;elenco_luci&quot;</span><span class=p>]:</span>
                    <span class=bp>self</span><span class=o>.</span><span class=n>turn_on</span><span class=p>(</span><span class=n>luce</span><span class=p>)</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Allarme Sirena! Accese tutte le luci&quot;</span><span class=p>)</span>
                <span class=c1># accendi tutte le luci di casa se suona l&#39;allarme di notte</span>
    <span class=k>for</span> <span class=n>servizio_notify</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;servizio_notify_push&quot;</span><span class=p>]:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>notifica_mobile</span><span class=p>(</span><span class=n>servizio_notify</span><span class=p>,</span> <span class=s2>&quot;mix&quot;</span><span class=p>,</span> <span class=s2>&quot;Antifurto&quot;</span><span class=p>,</span> <span class=s2>&quot;Sirena attivata!!&quot;</span><span class=p>)</span>

<span class=c1>#####</span>
<span class=k>def</span> <span class=nf>finestre</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entity</span><span class=p>,</span> <span class=n>attribute</span><span class=p>,</span> <span class=n>old</span><span class=p>,</span> <span class=n>new</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
    <span class=n>allarme_inserito</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>],</span> <span class=n>default</span><span class=o>=</span><span class=s2>&quot;off&quot;</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>allarme_inserito</span> <span class=o>==</span> <span class=s2>&quot;on&quot;</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Avviso finestre!&quot;</span><span class=p>)</span>
        <span class=n>nome</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span> <span class=n>attribute</span><span class=o>=</span><span class=s2>&quot;friendly_name&quot;</span><span class=p>)</span>
        <span class=n>messaggio</span> <span class=o>=</span> <span class=s2>&quot;Aperta &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>nome</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&quot; con Antifurto inserito!&quot;</span>
        <span class=k>for</span> <span class=n>servizio_notify</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;servizio_notify_push&quot;</span><span class=p>]:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>notifica_mobile</span><span class=p>(</span><span class=n>servizio_notify</span><span class=p>,</span> <span class=s2>&quot;mix&quot;</span><span class=p>,</span> <span class=s2>&quot;Antifurto&quot;</span><span class=p>,</span> <span class=n>messaggio</span><span class=p>)</span>

<span class=c1>#####</span>
<span class=k>def</span> <span class=nf>dimenticanza</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entity</span><span class=p>,</span> <span class=n>attribute</span><span class=p>,</span> <span class=n>old</span><span class=p>,</span> <span class=n>new</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;off&quot;</span><span class=p>:</span>
        <span class=n>messaggio</span> <span class=o>=</span> <span class=s2>&quot;Sono passati &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;allarme_dimenticato&quot;</span><span class=p>][</span><span class=s2>&quot;minuti_attesa&quot;</span><span class=p>])</span> <span class=o>+</span> <span class=s2>&quot; minuti con nessuno a casa. Vuoi attivare l&#39;antifurto?&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>notifica_mobile</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;servizio_notify_push&quot;</span><span class=p>])),</span> <span class=s2>&quot;actionable&quot;</span><span class=p>,</span> <span class=s2>&quot;Antifurto&quot;</span><span class=p>,</span> <span class=n>messaggio</span><span class=p>)</span>
        <span class=c1># manda la notifica solo al primo del dizionario</span>

<span class=c1>#####</span>
<span class=k>def</span> <span class=nf>dimenticanzanotturna</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;off&quot;</span><span class=p>:</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Avviso dimenticanza notturna antifurto&quot;</span><span class=p>)</span>
        <span class=n>messaggio2</span> <span class=o>=</span> <span class=s2>&quot;Sono le &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;allarme_dimenticato&quot;</span><span class=p>][</span><span class=s2>&quot;avviso_notturno&quot;</span><span class=p>][</span><span class=s2>&quot;ora_inizio&quot;</span><span class=p>])</span> <span class=o>+</span> <span class=s2>&quot;. Vuoi attivare l&#39;antifurto?&quot;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>notifica_mobile</span><span class=p>(</span><span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;servizio_notify_push&quot;</span><span class=p>])),</span> <span class=s2>&quot;actionable&quot;</span><span class=p>,</span> <span class=s2>&quot;Antifurto&quot;</span><span class=p>,</span> <span class=n>messaggio2</span><span class=p>)</span>

<span class=c1>#####</span>
<span class=k>def</span> <span class=nf>gestisci_rfid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>entity</span><span class=p>,</span> <span class=n>attribute</span><span class=p>,</span> <span class=n>old</span><span class=p>,</span> <span class=n>new</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>):</span>
    <span class=k>for</span> <span class=n>utente</span><span class=p>,</span> <span class=n>tag</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;rfid&quot;</span><span class=p>][</span><span class=s2>&quot;tag_abilitati&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;rfid&quot;</span><span class=p>][</span><span class=s2>&quot;lettore_rfid&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=n>tag</span><span class=p>:</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;off&quot;</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>call_service</span><span class=p>(</span><span class=s2>&quot;switch/turn_on&quot;</span><span class=p>,</span> <span class=n>entity_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Attivato Antifurto da tag RFID di &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>utente</span><span class=p>))</span>
            <span class=k>elif</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&quot;on&quot;</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>call_service</span><span class=p>(</span><span class=s2>&quot;switch/turn_off&quot;</span><span class=p>,</span> <span class=n>entity_id</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>args</span><span class=p>[</span><span class=s2>&quot;switch_antifurto&quot;</span><span class=p>])</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=s2>&quot;Disattivato Antifurto da tag RFID di &quot;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>utente</span><span class=p>))</span>
</code></pre></div> </td></tr></table> <h3 id=funzione-sta_suonando>Funzione <code>sta_suonando</code><a class=headerlink href=#funzione-sta_suonando title="Permanent link"> #</a></h3> <p>Lo scopo di questo callback è semplice: nel caso che l'antifurto stia effettivamente suonando (informazione che arriva da <code>sensore_sirena</code>, cioè <code>binary_sensor.allarme_antifurto</code> nel mio caso) la funzione:</p> <ul> <li>scrive l'evento in entrambi i log presenti (dell'addon e specifico dell'App Allarme);</li> <li>se il sole è tramontato accende tutte le luci elencate in <code>elenco_luci</code>;</li> <li>causa l'invio di una notifica di tipo <em>mix</em> in ciascuno dei servizi di notifica elencati in <code>servizio_notify_push</code>, con titolo "Antifurto" e messaggio "Sirena attivata!!".</li> </ul> <p>Se usiamo abitualmente scene con luci ad intensità variabile, potrebbe essere comodo sfruttare <a href=https://appdaemon.readthedocs.io/en/stable/HASS_API_REFERENCE.html#appdaemon.plugins.hass.hassapi.Hass.turn_on>la possibilità</a> della funzione <code>turn_on</code> di accettare parametri: potremmo ad esempio impostare un valore di <code>brightness_pct</code> per specificare con quale luminosità percentuale accendere le luci (<code>self.turn_on(luce, brightness_pct=100)</code>).</p> <h3 id=funzione-finestre>Funzione <code>finestre</code><a class=headerlink href=#funzione-finestre title="Permanent link"> #</a></h3> <div class="admonition failure"> <p>La maggior parte dei (rari) falsi allarmi scattati in casa sono dovuti alla dimenticanza.</p> </div> <p>Questa funzione cerca di ridurre questa possibilità, notificando sul mio telefono e quello della mia compagna se si apre una finestra (o porta-finestra) ad antifurto inserito.<sup id=fnref:3><a class=footnote-ref href=#fn:3>3</a></sup></p> <p>Il messaggio inviato da questa funzione contiene al suo interno il <code>friendly_name</code> della finestra che ne ha causato l'invio, sfruttando il parametro <code>attribute</code> della funzione <a href=https://appdaemon.readthedocs.io/en/stable/AD_API_REFERENCE.html#appdaemon.adapi.ADAPI.get_state><code>get_state</code></a>: è bene ricordare che il parametro <code>entity</code> passato al callback in questo caso equivale al classico <code>entity_id</code> utilizzato da Home Assistant.</p> <h3 id=funzioni-dimenticanza-e-dimenticanzanotturna>Funzioni <code>dimenticanza</code> e <code>dimenticanzanotturna</code><a class=headerlink href=#funzioni-dimenticanza-e-dimenticanzanotturna title="Permanent link"> #</a></h3> <p>La prima funzione permette di unire la <em>presence detection</em> di Home Assistant al nostro impianto di antifurto. AppDaemon possiede <a href=https://appdaemon.readthedocs.io/en/latest/HASS_API_REFERENCE.html#presence>diverse funzioni</a> che lavorano su questo argomento, permettendo un controllo molto sofisticato se fosse necessario. Nel nostro caso (come spiegato in precendenza) sfruttiamo un gruppo creato <em>ad hoc</em>, perché di rapida e semplice implementazione.</p> <p>Una novità che incontriamo qui è l'uso di <code>next(iter(self.args["servizio_notify_push"]))</code>. Questo codice consegnerà al callback solo il <em>primo</em> dei servizi di notifica elencati in <code>self.args["servizio_notify_push"]</code>, consentendo di stabilire una sorta di <em>priorità</em> all'interno dell'elenco. Questa necessità nasce dal fatto che non è necessario che tutti coloro ai quali si dovrebbe notificare il suonare della sirena debbano anche poter intervenire nel caso ci fossimo dimenticati di inserirlo.</p> <div class="admonition info"> <p>Nel mio caso essendo <code>mobile_app_iphone_di_alberto</code> il primo della lista, solo a me verranno notificate anche le dimenticanze (ed essendo una notifica <em>actionable</em> potrò inserire l'antifurto immediatamente), mentre a <code>mobile_app_iphone_di_alessandra</code> verrà notificato solo il resto.</p> </div> <p>Se la funzione <code>dimenticanza</code> si lega alla nostra presenza, la funzione <code>dimenticanzanotturna</code> lo fa solo all'orario che abbiamo scritto in configurazione: nell'ipotesi in cui fossimo in vacanze e non avessimo inserito l'antifurto, questo ci verrebbe notificato tutte le sere.</p> <h3 id=funzione-gestisci_rfid>Funzione <code>gestisci_rfid</code><a class=headerlink href=#funzione-gestisci_rfid title="Permanent link"> #</a></h3> <p>Per come ho configurato il mio sistema di lettura dei tag RFID, ho a disposizione su Home Assistant un <code>input_text.rfid</code> in cui viene scritto il codice identificativo del tag che viene letto. La funzione <code>gestisci_rfid</code> legge il valore di questa entità e la confronta con i tag specificati in configurazione come <code>"nome": codice_identificativo</code>: se c'è una corrispondenza attiva o disattiva l'antifurto loggando chi ha effettuato il cambio di stato.</p> <h2 id=conclusioni>Conclusioni<a class=headerlink href=#conclusioni title="Permanent link"> #</a></h2> <p>Mi sembra di aver mostrato le potenzialità di AppDaemon nell'integrare le funzioni di un classico sistema di allarme con Home Assistant. La scrittura delle funzioni che vi ho descritto nasce dalle mie particolari esigenze, e sono sicuro che le vostre non siano identiche: ciò che vi ho spiegato dovrebbe aiutarvi a colmare questo <em>gap</em> e scrivere la vostra versione.</p> <p>Vi ricordo di consultare la <a href=https://appdaemon.readthedocs.io/en/latest/ >documentazione</a> del progetto per ottenere ulteriori spunti, anche tramite i numerosi esempi che lì sono riportati. Per quanto riguarda la possibilità di integrare AppDaemon ad altri sistemi diversi da Home Assistant, vi consiglio di dare un'occhiata alla <a href=https://appdaemon.readthedocs.io/en/latest/MQTT_API_REFERENCE.html>sezione</a> relativa al plugin MQTT, uno standard <em>de facto</em> nel settore della domotica.</p> <p>Grazie per aver letto fino a qui e buon lavoro! Vi meritate una foto di un gattino per la pazienza.</p> <details class=quote><summary>Miao.</summary><p><img alt=gattino src=../gattino.jpg></p> </details> <h2 id=breve-sitografia>Breve sitografia<a class=headerlink href=#breve-sitografia title="Permanent link"> #</a></h2> <ul> <li><a href=https://github.com/hassio-addons/addon-appdaemon>AppDaemon addon per Home Assistant</a></li> <li><a href=https://www.triumvirat.org/2020/02/09/hass-notifications-appdaemon/ >Homeassistant, Actionable Notifications und Appdaemon</a></li> <li><a href=https://community.home-assistant.io/t/rest-post-from-python/18329>REST post from Python</a></li> <li><a href=https://requests.readthedocs.io/projects/it/it/latest/#>Libreria Requests</a></li> </ul> <div class=footnote> <hr> <ol> <li id=fn:1> <p>Vi ricordo che i moduli <code>rfid:</code>, <code>accendi_luci:</code>, <code>avviso_finestre:</code>, <code>allarme_dimenticato:</code> e <code>avviso_notturno:</code>, il cui funzionamento vi spiegherò in seguito, andranno configurati con <code>False</code> nel caso si decida di non utilizzarli.&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p>Per la parte hardware ho utilizzato un <a href=https://cdn-shop.adafruit.com/datasheets/pn532ds.pdf>lettore PN532</a> collegato ad una <a href=https://wiki.wemos.cc/products:d1:d1_mini>Wemos D1 Mini</a> con installato un firmware generato da <a href=https://esphome.io/guides/getting_started_hassio.html>ESPHome</a>, come vedremo nella descrizione della funzione appena citata.&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:3> <p>Chiaramente questa <em>feature</em> ha senso solo se i sensori dell'antifurto sono montati all'esterno dell'abitazione, e cerca di sfruttare il tempo necessario ad aprire le persiane o le tapparelle montate all'esterno.&#160;<a class=footnote-backref href=#fnref:3 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> </ol> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=.. title=Introduzione class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Precedente </span> Introduzione </span> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../assets/fonts/font-awesome.css> <a href=https://github.com/JohnnyZeta target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/application.c33a9706.js></script> <script src=../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../assets/javascripts/lunr/lunr.it.js></script> <script>app.initialize({version:"1.1",url:{base:".."}})</script> </body> </html>